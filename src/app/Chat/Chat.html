<div class="chat-detail">
  <div *ngIf="!loading; else loadingTpl"></div>

  <header class="chat-header">
    <h2 class="chat-title">
      {{ chatName || 'Chat' }}
    </h2>
    <button class="leave-btn" (click)="leaveChat()">Chat verlassen</button>
  </header>

  <!-- Nachrichten-Container fÃ¼r Scrollen -->
  <div #messagesContainer class="messages-container">
    <div *ngFor="let msg of messages" class="message" [class.mine]="msg.sender === currentUser">
      <div class="message-header">
        <span class="sender">{{ msg.sender }}</span>
        <span class="time">{{ msg.createdAt }}</span>
      </div>

      <div class="content" *ngIf="msg.content">
        <!-- Standort-Link -->
        <ng-container *ngIf="isLocationLink(msg.content); else normalText">
          <a [href]="msg.content" target="_blank" rel="noopener"> Mein aktueller Standort </a>
        </ng-container>

        <!-- normale Textnachricht -->
        <ng-template #normalText>
          {{ msg.content }}
        </ng-template>
      </div>

      <img *ngIf="msg.imageUrl" [src]="msg.imageUrl" alt="Bild" class="image-message" />
    </div>
  </div>

  <div class="message-input">
    <!-- Foto- / Kamera-Container -->
    <div *ngIf="showPhotoContainer" class="photo-container">
      <video #video autoplay playsinline class="camera-preview" [hidden]="!streamActive"></video>
      <canvas #canvas hidden></canvas>

      <img *ngIf="previewUrl" [src]="previewUrl" alt="Foto Vorschau" class="photo-preview" />
    </div>

    <div class="camera-buttons">
      <!-- Verstecktes File-Input nur fÃ¼r PNG -->
      <input #fileInput type="file" accept="image/png" hidden (change)="onFileSelected($event)" />

      <!-- Button Ã¶ffnet den Datei-Dialog -->
      <button type="button" (click)="fileInput.click()">ğŸ”—</button>

      <button *ngIf="!streamActive && !previewUrl" type="button" (click)="openCamera()">ğŸ“·</button>
      <button *ngIf="streamActive" type="button" (click)="takePhoto()">ğŸ“¸ Foto machen</button>
      <button *ngIf="streamActive" type="button" (click)="stopCamera()">âœ– Kamera stoppen</button>
      <button *ngIf="previewUrl" type="button" (click)="removePhoto()">ğŸ—‘ Foto entfernen</button>
    </div>

    <!-- Standort teilen -->
    <button type="button" (click)="shareCurrentLocation()" [disabled]="locationLoading">ğŸ“</button>

    <!-- Texteingabe -->
    <input
      type="text"
      [(ngModel)]="newMessage"
      placeholder="Nachricht schreiben..."
      (keyup.enter)="sendMessage()"
    />

    <!-- Senden -->
    <button type="button" (click)="sendMessage()">â¤</button>
  </div>

  <ng-template #loadingTpl>
    <div>Loading messages...</div>
  </ng-template>
</div>
